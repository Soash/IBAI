{% extends 'base.html' %}
{% load static %}

{% block content %}
<main class="main_wrapper">

  {% include 'partials/top-banner.html' %}
  {% include 'partials/navbar.html' %}
  {% include 'partials/mobile-menu.html' %}

  <section class="py-5">
    <div class="container">
      <div class="row justify-content-center">

        <!-- Main Content -->
        <div class="col-xl-8 col-lg-8" style="max-width: 850px;">

          <!-- Video -->
          {% if training.video_embed_url %}
          <div class="ratio ratio-16x9 mb-4 shadow-sm rounded-4 overflow-hidden">
            <iframe
              src="{{ training.video_embed_url }}?rel=0"
              title="Training Intro Video"
              frameborder="0"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              referrerpolicy="strict-origin-when-cross-origin"
              allowfullscreen>
            </iframe>
          </div>
          {% endif %}

          <!-- Content Card -->
          <article class="p-4 p-md-5 rounded-4 shadow-sm bg-white">
            <h2 class="fw-bold mb-3 text-center">{{ training.name }}</h2>
            <div class="lead" style="line-height: 1.8; text-align: justify;">
              {{ training.summary }}
            </div>
          </article>

          <!-- Tabs Section -->
          <div class="mt-4">
            <ul class="nav course__tap__wrap" id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="single__tab__link" data-bs-toggle="tab"
                        data-bs-target="#description" type="button">
                  <i class="icofont-ui-note"></i> Description
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="single__tab__link" data-bs-toggle="tab"
                        data-bs-target="#instructor" type="button">
                  <i class="icofont-teacher"></i> Instructor
                </button>
              </li>
            </ul>

            <div class="tab-content mt-3" id="myTabContent">

              <!-- Description -->
              <div class="tab-pane fade" id="description" role="tabpanel">
                <div class="experence__heading"><h5>Description</h5></div>
                <div class="experence__description">
                  {{ training.description|safe }}
                </div>
              </div>

              <!-- Instructor -->
              <div class="tab-pane fade" id="instructor" role="tabpanel">
                <div class="blogsidebar__content__wraper__2 tab__instructor">
                  {% for instructor in training.instructors.all %}
                  <div class="blogsidebar__content__inner__2 mb-3 d-flex gap-3">
                    <div class="blogsidebar__img__2">
                      {% if instructor.profile_picture %}
                      <img src="{{ instructor.profile_picture.url }}" width="95" class="rounded">
                      {% else %}
                      <img src="{% static 'img/profile.png' %}" width="95" class="rounded">
                      {% endif %}
                    </div>
                    <div>
                      <h5 class="mb-1">{{ instructor.first_name }}</h5>
                      <p class="mb-2">{{ instructor.bio }}</p>
                      <ul class="d-flex gap-2 social-links">
                        <li><a href="mailto:{{ instructor.email }}"><i class="icofont-email"></i></a></li>
                        {% if instructor.facebook_link %}<li><a href="{{ instructor.facebook_link }}"><i class="icofont-facebook"></i></a></li>{% endif %}
                        {% if instructor.linkedin_link %}<li><a href="{{ instructor.linkedin_link }}"><i class="icofont-linkedin"></i></a></li>{% endif %}
                        {% if instructor.website %}<li><a href="{{ instructor.website }}"><i class="icofont-web"></i></a></li>{% endif %}
                      </ul>
                    </div>
                  </div>
                  {% endfor %}
                </div>
              </div>

            </div>
          </div>

          <!-- Comments Section -->
          <div class="blog__details__comment mt-5">
            <h5>({{ total_comments }}) Comment</h5>

            {% for comment in comments %}
            <div class="blog__details__comment__inner">
              <div class="author__img">
                {% if comment.user.profile_picture %}
                <img src="{{ comment.user.profile_picture.url }}" width="75">
                {% else %}
                <img src="{% static 'img/profile.png' %}" width="75">
                {% endif %}
              </div>
              <div class="author__content">
                <h6>{{ comment.user.username }}</h6>
                <small>{{ comment.created_at|date:"d F Y" }}</small>
                <p>{{ comment.content }}</p>

                {% if request.user == comment.user %}
                <form method="post" action="{% url 'delete_training_comment' comment.id %}">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-outline-danger">Delete</button>
                </form>
                {% endif %}
              </div>
            </div>
            {% endfor %}
          </div>

          {% if user.is_authenticated %}
          <form method="post" action="{% url 'add_comment_training' training.slug %}" class="mt-4">
            {% csrf_token %}
            <textarea name="content" class="form-control" rows="3" placeholder="Write your thoughts..." required></textarea>
            <button type="submit" class="btn btn-primary mt-3">Post Comment</button>
          </form>
          {% else %}
          <div class="alert alert-info mt-4">
            <a href="{% url 'user_login' %}">Login</a> to add a comment.
          </div>
          {% endif %}

          <!-- Bottom Buttons -->
          <div class="d-flex justify-content-between align-items-center mt-5">
            <a href="{% url 'training_list' %}" class="btn btn-outline-secondary rounded-pill px-4">
              ← Back to Training List
            </a>
            <a href="#top" class="btn btn-primary rounded-pill px-4">
              ↑ Top
            </a>
          </div>

        </div>

        <!-- Sidebar -->
        <div class="col-xl-4 col-lg-4 mt-5 mt-lg-0">
          <div class="course__details__sidebar sticky-top" style="top: 90px;">
            <div class="event__sidebar__wraper">

              <div class="event__price__wraper">
                <div class="event__price">
                    ৳{{ training.current_price }}
                </div>
                <div class="event__Price__button">
                    <a href="#" style="width: 150px;">Student</a>
                </div>
              </div>
              <div class="event__price__wraper">
                <div class="event__price">
                    ৳{{ training.professional_price }}
                </div>
                <div class="event__Price__button">
                    <a href="#" style="width: 150px;">Professional</a>
                </div>
              </div>

              <div class="course__summery__button mb-3">
                {% if training.registration_link %}
                <a href="{{ training.registration_link }}" class="default__button" target="_blank">
                  Register Now
                </a>
                {% else %}
                <a class="default__button disabled">
                  Registration TBA
                </a>
                {% endif %}
              </div>

              <div class="course__summery__lists">
                <ul>
                  <li><div class="course__summery__item"><span class="sb_label">Medium</span><span>{{ training.get_medium_display }}</span></div></li>
                  <li><div class="course__summery__item"><span class="sb_label">Platform / Branch</span><span>{% if training.platform %}{{ training.get_platform_display }}{% else %}{{ training.get_branch_display }}{% endif %}</span></div></li>
                  <li><div class="course__summery__item"><span class="sb_label">Date</span><span>{{ training.date|date:"d/m/Y" }}</span></div></li>
                  <li><div class="course__summery__item"><span class="sb_label">Certificate</span><span>Yes</span></div></li>
                  <li><div class="course__summery__item"><span class="sb_label">Language</span><span>Bangla</span></div></li>
                </ul>
              </div>

              <div class="course__summery__button mt-3">
                <p>More inquiry about training</p>
                <a class="default__button default__button--3" href="tel:+8801517831136">
                  <i class="icofont-phone"></i> +880 1517 831 136
                </a>
              </div>

            </div>
          </div>
        </div>

      </div>
    </div>
  </section>

  {% include 'partials/footer.html' %}
</main>
{% endblock %}
